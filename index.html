<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SROI Calculator - ระบบคำนวณผลตอบแทนทางสังคมจากการลงทุน</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            /* Bangkok University Colors */
            --color-primary: #1e3a8a;
            --color-primary-light: #3b82f6;
            --color-secondary: #f59e0b;
            --color-success: #10b981;
            --color-danger: #ef4444;
            --color-warning: #f59e0b;
            --color-info: #3b82f6;
            --color-light: #f8fafc;
            --color-dark: #1e293b;
            --color-border: #e2e8f0;
            --color-text: #334155;
            --color-text-light: #64748b;
            
            /* Spacing */
            --space-xs: 0.25rem;
            --space-sm: 0.5rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
            --space-2xl: 3rem;
            
            /* Border radius */
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: var(--color-text);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--space-md);
        }

        .header {
            background: var(--color-primary);
            color: white;
            padding: var(--space-lg) 0;
            box-shadow: var(--shadow-lg);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: var(--space-md);
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: var(--space-xs);
        }

        .header .subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .developer-credit {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-md);
            border: none;
            border-radius: var(--radius-md);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.2s ease;
            font-family: 'Sarabun', sans-serif;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--color-primary-light);
        }

        .btn-secondary {
            background: var(--color-light);
            color: var(--color-text);
            border: 1px solid var(--color-border);
        }

        .btn-secondary:hover {
            background: #e2e8f0;
        }

        .btn-danger {
            background: var(--color-danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-success {
            background: var(--color-success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-md);
        }

        .login-card {
            background: white;
            padding: var(--space-2xl);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 450px;
            text-align: center;
        }

        .login-card h2 {
            color: var(--color-primary);
            margin-bottom: var(--space-lg);
            font-size: 1.8rem;
            font-weight: 600;
            font-family: 'Sarabun', sans-serif;
        }

        .form-group {
            margin-bottom: var(--space-md);
            text-align: left;
        }

        .form-label {
            display: block;
            margin-bottom: var(--space-sm);
            font-weight: 500;
            color: var(--color-text);
            font-family: 'Sarabun', sans-serif;
        }

        .form-control {
            width: 100%;
            padding: var(--space-sm) var(--space-md);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            font-size: 0.95rem;
            transition: border-color 0.2s ease;
            font-family: 'Sarabun', sans-serif;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }

        .form-link {
            text-align: center;
            margin-top: var(--space-md);
            color: var(--color-text-light);
            font-size: 0.9rem;
            font-family: 'Sarabun', sans-serif;
        }

        .form-link a {
            color: var(--color-primary);
            text-decoration: none;
            font-weight: 500;
            font-family: 'Sarabun', sans-serif;
        }

        .form-link a:hover {
            text-decoration: underline;
        }

        .divider {
            display: flex;
            align-items: center;
            margin: var(--space-lg) 0;
            color: var(--color-text-light);
            font-size: 0.9rem;
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid var(--color-border);
        }

        .divider span {
            padding: 0 var(--space-md);
        }

        .google-btn {
            width: 100%;
            padding: var(--space-sm) var(--space-md);
            border: 1px solid var(--color-border);
            background: white;
            border-radius: var(--radius-md);
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            font-family: 'Sarabun', sans-serif;
        }

        .google-btn:hover {
            background: var(--color-light);
        }

        .google-btn img {
            width: 20px;
            height: 20px;
        }

        #mainApp {
            display: none;
        }

        .main-content {
            margin-top: var(--space-xl);
            padding-bottom: var(--space-2xl);
        }

        .card {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            box-shadow: var(--shadow-md);
            margin-bottom: var(--space-lg);
        }

        .steps-nav {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--space-2xl);
            flex-wrap: wrap;
            gap: var(--space-sm);
        }

        .step {
            flex: 1;
            min-width: 120px;
            padding: var(--space-sm);
            text-align: center;
            background: var(--color-light);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Sarabun', sans-serif;
        }

        .step:hover {
            background: #e2e8f0;
        }

        .step.active {
            background: var(--color-primary);
            color: white;
        }

        .step-number {
            display: block;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: var(--space-xs);
        }

        .step-name {
            font-size: 0.85rem;
            font-family: 'Sarabun', sans-serif;
        }

        .step-content {
            display: none;
        }

        .step-content.active {
            display: block;
        }

        .step-header {
            margin-bottom: var(--space-xl);
        }

        .step-title {
            color: var(--color-primary);
            font-size: 1.8rem;
            margin-bottom: var(--space-sm);
            font-family: 'Sarabun', sans-serif;
        }

        .step-description {
            color: var(--color-text-light);
            font-size: 1rem;
            font-family: 'Sarabun', sans-serif;
        }

        .section {
            margin-bottom: var(--space-xl);
        }

        .section-title {
            font-size: 1.3rem;
            color: var(--color-primary);
            margin-bottom: var(--space-md);
            font-family: 'Sarabun', sans-serif;
        }

        .input-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-md);
            margin-bottom: var(--space-md);
        }

        .table-container {
            overflow-x: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: var(--space-md);
        }

        .table th,
        .table td {
            padding: var(--space-sm) var(--space-md);
            text-align: left;
            border-bottom: 1px solid var(--color-border);
            font-family: 'Sarabun', sans-serif;
        }

        .table th {
            background: var(--color-light);
            font-weight: 600;
            color: var(--color-primary);
        }

        .table tbody tr:hover {
            background: var(--color-light);
        }

        .action-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: var(--space-2xl);
            padding-top: var(--space-xl);
            border-top: 1px solid var(--color-border);
        }

        .chart-container {
            background: white;
            padding: var(--space-lg);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            margin-bottom: var(--space-lg);
        }

        .chart-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: var(--space-md);
            font-family: 'Sarabun', sans-serif;
        }

        .chart-canvas {
            position: relative;
            height: 300px;
        }

        .alert {
            padding: var(--space-md);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-md);
            font-family: 'Sarabun', sans-serif;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.2rem;
            }

            .steps-nav {
                flex-direction: column;
            }

            .step {
                min-width: 100%;
            }

            .input-group {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
                gap: var(--space-md);
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Authentication Screen -->
    <div id="authScreen" class="login-container">
        <div class="login-card">
            <!-- Login Form -->
            <div id="loginForm">
                <h2>เข้าสู่ระบบ</h2>
                <p class="step-description" style="margin-bottom: var(--space-lg);">SROI Calculator - ระบบคำนวณผลตอบแทนทางสังคมจากการลงทุน</p>
                
                <div id="loginAlert"></div>
                
                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label class="form-label" for="loginEmail">อีเมล</label>
                        <input type="email" class="form-control" id="loginEmail" placeholder="your@email.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="loginPassword">รหัสผ่าน</label>
                        <input type="password" class="form-control" id="loginPassword" placeholder="••••••••" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: var(--space-md);">
                        เข้าสู่ระบบ
                    </button>
                </form>
                
                <div class="divider">
                    <span>หรือ</span>
                </div>
                
                <button type="button" class="google-btn" onclick="handleGoogleSignIn()">
                    <svg width="20" height="20" viewBox="0 0 48 48">
                        <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path>
                        <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path>
                        <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"></path>
                        <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path>
                    </svg>
                    เข้าสู่ระบบด้วย Google
                </button>
                
                <div class="form-link">
                    ยังไม่มีบัญชี? <a href="javascript:void(0)" onclick="toggleForm()">สมัครสมาชิก</a>
                </div>
            </div>

            <!-- Register Form -->
            <div id="registerForm" style="display: none;">
                <h2>สมัครสมาชิก</h2>
                <p class="step-description" style="margin-bottom: var(--space-lg);">สร้างบัญชีใหม่เพื่อเริ่มใช้งาน SROI Calculator</p>
                
                <div id="registerAlert"></div>
                
                <form onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label class="form-label" for="registerName">ชื่อ-นามสกุล</label>
                        <input type="text" class="form-control" id="registerName" placeholder="ชื่อ นามสกุล" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="registerEmail">อีเมล</label>
                        <input type="email" class="form-control" id="registerEmail" placeholder="your@email.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="registerOrganization">หน่วยงาน (ถ้ามี)</label>
                        <input type="text" class="form-control" id="registerOrganization" placeholder="ชื่อหน่วยงาน">
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: var(--space-md);">
                        สมัครสมาชิก
                    </button>
                </form>
                
                <div class="form-link">
                    มีบัญชีอยู่แล้ว? <a href="javascript:void(0)" onclick="toggleForm()">เข้าสู่ระบบ</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp">
        <div class="header">
            <div class="container">
                <div class="header-content">
                    <div>
                        <h1>SROI Calculator</h1>
                        <p class="subtitle">ระบบคำนวณผลตอบแทนทางสังคมจากการลงทุน</p>
                    </div>
                    <div>
                        <span id="userNameDisplay" style="margin-right: var(--space-md);"></span>
                        <button class="btn btn-secondary" onclick="handleLogout()">ออกจากระบบ</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="main-content">
                <div class="card">
                    <div class="steps-nav">
                        <div class="step active" onclick="goToStep(1)">
                            <span class="step-number">1</span>
                            <span class="step-name">ข้อมูลโครงการ</span>
                        </div>
                        <div class="step" onclick="goToStep(2)">
                            <span class="step-number">2</span>
                            <span class="step-name">ผู้มีส่วนได้ส่วนเสีย</span>
                        </div>
                        <div class="step" onclick="goToStep(3)">
                            <span class="step-number">3</span>
                            <span class="step-name">ผลลัพธ์</span>
                        </div>
                        <div class="step" onclick="goToStep(4)">
                            <span class="step-number">4</span>
                            <span class="step-name">คำนวณมูลค่า</span>
                        </div>
                        <div class="step" onclick="goToStep(5)">
                            <span class="step-number">5</span>
                            <span class="step-name">ผลการคำนวณ</span>
                        </div>
                        <div class="step" onclick="goToStep(6)">
                            <span class="step-number">6</span>
                            <span class="step-name">สร้างรายงาน</span>
                        </div>
                    </div>

                    <div class="steps-container">
                        <!-- Step 1: Project Information -->
                        <div id="step1" class="step-content active">
                            <div class="step-header">
                                <h2 class="step-title">ขั้นตอนที่ 1: ข้อมูลโครงการ</h2>
                                <p class="step-description">กรอกข้อมูลพื้นฐานของโครงการ</p>
                            </div>
                            
                            <div class="section">
                                <h3 class="section-title">รายละเอียดโครงการ</h3>
                                <div class="input-group">
                                    <div class="form-group">
                                        <label class="form-label">ชื่อโครงการ</label>
                                        <input type="text" class="form-control" placeholder="กรอกชื่อโครงการ">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">ระยะเวลาโครงการ (ปี)</label>
                                        <input type="number" class="form-control" placeholder="เช่น 3">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">งบประมาณทั้งหมด (บาท)</label>
                                        <input type="number" class="form-control" placeholder="เช่น 1000000">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">หน่วยงานดำเนินการ</label>
                                        <input type="text" class="form-control" placeholder="ชื่อหน่วยงาน">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="section">
                                <h3 class="section-title">ขอบเขตการประเมิน</h3>
                                <div class="form-group">
                                    <label class="form-label">วัตถุประสงค์โครงการ</label>
                                    <textarea class="form-control" rows="4" placeholder="อธิบายวัตถุประสงค์หลักของโครงการ"></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">กลุ่มเป้าหมาย</label>
                                    <textarea class="form-control" rows="3" placeholder="ระบุกลุ่มเป้าหมายของโครงการ"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Step 2: Stakeholders -->
                        <div id="step2" class="step-content">
                            <div class="step-header">
                                <h2 class="step-title">ขั้นตอนที่ 2: ระบุผู้มีส่วนได้ส่วนเสีย</h2>
                                <p class="step-description">กำหนดกลุ่มผู้มีส่วนได้ส่วนเสียที่ได้รับผลกระทบจากโครงการ</p>
                            </div>
                            
                            <div class="section">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-md);">
                                    <h3 class="section-title" style="margin-bottom: 0;">รายชื่อผู้มีส่วนได้ส่วนเสีย</h3>
                                    <button type="button" class="btn btn-primary" onclick="addStakeholder()">+ เพิ่มผู้มีส่วนได้ส่วนเสีย</button>
                                </div>
                                
                                <div class="table-container">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>ชื่อกลุ่ม</th>
                                                <th>จำนวนคน</th>
                                                <th>ประเภท</th>
                                                <th>คำอธิบาย</th>
                                                <th>จัดการ</th>
                                            </tr>
                                        </thead>
                                        <tbody id="stakeholderTableBody">
                                            <tr>
                                                <td colspan="5" style="text-align: center;">ยังไม่มีข้อมูล (คลิก "เพิ่มผู้มีส่วนได้ส่วนเสีย" เพื่อเริ่มต้น)</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Step 3: Outcomes -->
                        <div id="step3" class="step-content">
                            <div class="step-header">
                                <h2 class="step-title">ขั้นตอนที่ 3: กำหนดผลลัพธ์</h2>
                                <p class="step-description">ระบุผลลัพธ์ที่เกิดขึ้นกับแต่ละกลุ่มผู้มีส่วนได้ส่วนเสีย</p>
                            </div>
                            
                            <div class="section">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-md);">
                                    <h3 class="section-title" style="margin-bottom: 0;">ผลลัพธ์ที่เกิดขึ้น</h3>
                                    <button type="button" class="btn btn-primary" onclick="addOutcome()">+ เพิ่มผลลัพธ์</button>
                                </div>
                                
                                <div class="table-container">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>ผู้มีส่วนได้ส่วนเสีย</th>
                                                <th>ผลลัพธ์</th>
                                                <th>ประเภท</th>
                                                <th>ตัวชี้วัด</th>
                                                <th>จัดการ</th>
                                            </tr>
                                        </thead>
                                        <tbody id="outcomeTableBody">
                                            <tr>
                                                <td colspan="5" style="text-align: center;">ยังไม่มีข้อมูล (คลิก "เพิ่มผลลัพธ์" เพื่อเริ่มต้น)</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Step 4: Valuation -->
                        <div id="step4" class="step-content">
                            <div class="step-header">
                                <h2 class="step-title">ขั้นตอนที่ 4: คำนวณมูลค่าผลลัพธ์</h2>
                                <p class="step-description">ประเมินมูลค่าทางการเงินของผลลัพธ์แต่ละข้อ</p>
                            </div>
                            
                            <div class="section">
                                <h3 class="section-title">การกำหนดมูลค่า</h3>
                                <div class="table-container">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>ผลลัพธ์</th>
                                                <th>จำนวนหน่วย</th>
                                                <th>มูลค่าต่อหน่วย (บาท)</th>
                                                <th>Deadweight (%)</th>
                                                <th>Attribution (%)</th>
                                                <th>Displacement (%)</th>
                                                <th>ระยะเวลา (ปี)</th>
                                            </tr>
                                        </thead>
                                        <tbody id="valuationTableBody">
                                            <tr>
                                                <td colspan="7" style="text-align: center;">ยังไม่มีข้อมูล</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <div class="section">
                                <h3 class="section-title">คำอธิบายปัจจัยปรับค่า</h3>
                                <ul style="line-height: 2;">
                                    <li><strong>Deadweight:</strong> ผลลัพธ์ที่จะเกิดขึ้นอยู่แล้วแม้ไม่มีโครงการ</li>
                                    <li><strong>Attribution:</strong> ส่วนของผลลัพธ์ที่เกิดจากองค์กรอื่นมีส่วนร่วม</li>
                                    <li><strong>Displacement:</strong> ผลกระทบเชิงลบที่อาจเกิดขึ้นกับกิจกรรมอื่น</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Step 5: Results -->
                        <div id="step5" class="step-content">
                            <div class="step-header">
                                <h2 class="step-title">ขั้นตอนที่ 5: ผลการคำนวณ SROI</h2>
                                <p class="step-description">สรุปผลการคำนวณและวิเคราะห์ผลกระทบทางสังคม</p>
                            </div>
                            
                            <div class="section">
                                <h3 class="section-title">ผลลัพธ์ SROI</h3>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--space-lg); margin-bottom: var(--space-xl);">
                                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: var(--space-xl); border-radius: var(--radius-lg); color: white; text-align: center;">
                                        <div style="font-size: 0.9rem; margin-bottom: var(--space-sm); opacity: 0.9;">อัตราผลตอบแทน SROI</div>
                                        <div style="font-size: 2.5rem; font-weight: 700;" id="sroiRatio">0.00 : 1</div>
                                    </div>
                                    <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: var(--space-xl); border-radius: var(--radius-lg); color: white; text-align: center;">
                                        <div style="font-size: 0.9rem; margin-bottom: var(--space-sm); opacity: 0.9;">มูลค่าผลกระทบสุทธิ</div>
                                        <div style="font-size: 2rem; font-weight: 700;" id="netImpact">฿0</div>
                                    </div>
                                    <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); padding: var(--space-xl); border-radius: var(--radius-lg); color: white; text-align: center;">
                                        <div style="font-size: 0.9rem; margin-bottom: var(--space-sm); opacity: 0.9;">มูลค่าปัจจุบันรวม (NPV)</div>
                                        <div style="font-size: 2rem; font-weight: 700;" id="totalNPV">฿0</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="section">
                                <h3 class="section-title">แผนภูมิวิเคราะห์</h3>
                                
                                <div class="chart-container">
                                    <div class="chart-title">การกระจายผลประโยชน์ตามผู้มีส่วนได้ส่วนเสีย</div>
                                    <div class="chart-canvas">
                                        <canvas id="stakeholderChart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="chart-container">
                                    <div class="chart-title">การกระจายผลประโยชน์ตามมิติ</div>
                                    <div class="chart-canvas">
                                        <canvas id="dimensionChart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="chart-container">
                                    <div class="chart-title">เปรียบเทียบมูลค่าผลกระทบ</div>
                                    <div class="chart-canvas">
                                        <canvas id="comparisonChart"></canvas>
                                    </div>
                                </div>
                                
                                <div class="chart-container">
                                    <div class="chart-title">แนวโน้มมูลค่าตามช่วงเวลา</div>
                                    <div class="chart-canvas">
                                        <canvas id="trendChart"></canvas>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="section">
                                <h3 class="section-title">ตารางสรุปผลการคำนวณ</h3>
                                <div class="table-container">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>ผู้มีส่วนได้ส่วนเสีย</th>
                                                <th>ผลลัพธ์</th>
                                                <th>ประเภท</th>
                                                <th>มูลค่าเริ่มต้น</th>
                                                <th>Deadweight</th>
                                                <th>Attribution</th>
                                                <th>Displacement</th>
                                                <th>ผลกระทบสุทธิ</th>
                                                <th>มูลค่าปัจจุบัน</th>
                                            </tr>
                                        </thead>
                                        <tbody id="summaryTableBody">
                                            <tr>
                                                <td colspan="9" style="text-align: center;">ไม่มีข้อมูล</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Step 6: Generate Report -->
                        <div id="step6" class="step-content">
                            <div class="step-header">
                                <h2 class="step-title">ขั้นตอนที่ 6: สร้างรายงาน</h2>
                                <p class="step-description">สร้างรายงาน SROI แบบเต็มรูปแบบ</p>
                            </div>
                            
                            <div class="section">
                                <h3 class="section-title">รายงานจะประกอบด้วย</h3>
                                <ul style="line-height: 2;">
                                    <li>1. ข้อมูลโครงการและขอบเขตการประเมิน</li>
                                    <li>2. ผู้มีส่วนได้ส่วนเสียและผลลัพธ์</li>
                                    <li>3. แผนที่ผลกระทบ (Impact Map)</li>
                                    <li>4. การคำนวณและปัจจัยปรับค่า</li>
                                    <li>5. ผลการคำนวณ SROI</li>
                                    <li>6. แผนภูมิและกราฟวิเคราะห์</li>
                                    <li>7. สรุปและข้อเสนอแนะ</li>
                                </ul>
                            </div>
                            
                            <div class="section" style="text-align: center;">
                                <button type="button" class="btn btn-success" onclick="generatePDF()" style="font-size: 1.2rem; padding: var(--space-lg) var(--space-2xl);">
                                    📄 สร้างรายงาน PDF
                                </button>
                                <p style="margin-top: var(--space-md); color: var(--color-text-light);">คลิกเพื่อสร้างและดาวน์โหลดรายงานเป็นไฟล์ PDF</p>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="action-buttons">
                            <button type="button" class="btn btn-secondary" onclick="previousStep()" id="prevBtn">← ก่อนหน้า</button>
                            <button type="button" class="btn btn-primary" onclick="nextStep()" id="nextBtn">ถัดไป →</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK - Initialize FIRST -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
      import { getAuth } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
      
      const firebaseConfig = {
        apiKey: "AIzaSyC-r39KHKkmOZW5xjmNRiKrmPnSWeC9Xrg",
        authDomain: "sroi-bu.firebaseapp.com",
        projectId: "sroi-bu",
        storageBucket: "sroi-bu.firebasestorage.app",
        messagingSenderId: "467289509127",
        appId: "1:467289509127:web:afc1a93643cbddce0849a2"
      };
      
      // Initialize Firebase and make globally available
      window.firebaseApp = initializeApp(firebaseConfig);
      window.auth = getAuth(window.firebaseApp);
      
      console.log('✅ Firebase initialized successfully');
      
      // Dispatch event to let app.js know Firebase is ready
      window.dispatchEvent(new Event('firebaseReady'));
    </script>
    
    <!-- Main App Script - Load AFTER Firebase -->
    <script src="app.js"></script>
    
</body>
</html>
